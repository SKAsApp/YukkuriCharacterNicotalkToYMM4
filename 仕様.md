# 仕様・設計

## 流れ

1. アプリ起動する。
1. 変換元ディレクトリーを選択する。
1. 出力先ディレクトリーを選択する。
1. 変換ボタンを押す。
	- 入力に問題があればエラーメッセージ
	- 問題なければ変換処理
1. 完了した旨が表示される。
1. 別の素材も変換するか，閉じる。


## UI

- 1画面＋メッセージボックス（？）
- 最前面画像ミギシタやフレーム補間設定のUIをベースに
- 流行に合わせて，メニューバーは廃止
	- ただし，コマンドバーに次は付けたい
		- コピー
		- 貼り付け
		- （言語）
		- About（について）


## フレームワーク

- ひとまずUWPで実装
	- ファイル操作も多く，問題があればWPFで実装
	- それでも無理ならお得意のPythonのpathlibでw
	- （Windows分からん）
- UWPのサスペンドについては次のことが分かった
	- 通常のサスペンド：変数の値は保持される
	- 終了された場合：完全にリセットされる
- 通常のサスペンドであれば選んだディレクトリーの情報は残り，終了された場合ももう1度選ぶだけでよいため，中断・再開についての処理は特別実装しないこととする。


## 処理

nicotalk形式をYMM4形式へ変換

1. まず，変換前ディレクトリーを出力先ディレクトリーにコピー
1. その後，出力先ディレクトリーで次のような処理
	- ※ LA：最終アルファベット，LI：最終インデックス
1. ひとまず「目」と「口」の動きのみ
	- nicotalk，YMM4ともに，それぞれ「目」フォルダー，「口」フォルダーに入っている。
	1. 「**目**」に関して
		- **nicotalk**：prefixのみが開(OPEN)で，prefix＋a，prefix＋b，prefix＋c，……と閉(close)
		- **YMM4**：prefix＋0が閉(close)で，prefix＋1，prefix＋2，……と開(OPEN)　prefixのみが完全に開(OPEN)
		- **ようするに**：prefix＋LA→prefix＋0，prefix＋(LA－1)→prefix＋1，……，prefix＋a→prefix＋LI，prefixのみ→（変更なし）
		- nicotalkの目アニメーションの種類は次のとおり
			- パチ（まばたき）：a b c d e f g h i j
			- 登場退場（スムーズな目閉じ）（非対応）：k l m n o p q r s t
			- ループ（非対応）**（5）**：aa bb cc …… zz
			- ループ（非対応）**（5）**：f g h i j
		- その他
			- 目・眉・口セット：x
			- 目・口セット：y
			- 目・眉セット：z
	1. 「**口**」に関して
		- **nicotalk**：prefixのみが閉(close)で，prefix＋a，prefix＋b，prefix＋c，……と開(OPEN)
		- **YMM4**：prefix＋0が閉(close)で，prefix＋1，prefix＋2，……と開(OPEN)　prefixのみが完全に開(OPEN)
		- **ようするに**：prefixのみ→prefix＋0，prefix＋a→prefix＋1，……，prefix＋(LA－1)→prefix＋LI，prefix＋LA→prefixのみ
		- nicotalkの口アニメーションは次のとおり
			- パク：a b c d e f g h i j
1. 他の部位に関して
	- 次以外は「他」へ名前変更＆移動（`（キャラ名）\他\（部位）_（元ファイル名）（（注釈））.png`）
		- 口
		- 体
		- 眉
		- 目
	- 具体的には次がある
		- 顔（＝顔色）
		- 後（＝キャラの後ろ）（非対応）
		- 全（＝全体でアニメーションなし）
		- 髪（＝眉の上に半透明）（非対応）
		- 服下 **（5）**
		- 服上 **（5）**
		- 体 **（5は以前と別）**
	- nicotalkの命名規則
		- 顔
			- a：赤面（下表示）（非対応）
			- b：蒼白（乗算表示）（非対応）
		- 後
			- u数字（例：00u1）：最背面（00u1，00u2を同時表示）（非対応）
			- m数字（例：00m1）：最前面
		- 全
			- 00.pngはなく，01.pngから
		- 髪
			- 00.png：不透明前髪
			- 01.png：半透明前髪
			- cf：服より前 **（5）**
		- 体 **（5）**
			- b：色黒
			- w：色白
			- h：最前面の手
		- 体＆服上＆髪 **（5）**
			- m：前配置
			- u：後ろ配置（非対応）
		- 服上＆服下 **（5）**
			- c：固定（ポーズに影響されない）
		- 髪・目・服上・服下（色系）**（5）**
			- o：標準
			- b：黒
			- c：灰色
			- d：暗め
			- l：明るめ
			- w：白
			- v：色変更しない部分
			- s：髪・眉・服から落ちる肌影（肌の色の影響下）
